<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jankenoboe - Due Song Review</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #e0e0e0; padding: 20px; }
h1 { color: #e94560; margin-bottom: 8px; font-size: 1.5em; }
.stats { background: #16213e; border-radius: 8px; padding: 16px; margin-bottom: 20px; }
.stats .total { font-size: 1.2em; margin-bottom: 8px; color: #e94560; font-weight: bold; }
.level-dist { margin-top: 8px; }
.level-badge { display: inline-block; background: #0f3460; color: #e0e0e0; padding: 2px 8px; border-radius: 12px; font-size: 0.85em; margin: 2px; }
.song-card { background: #16213e; border-radius: 8px; padding: 14px; margin-bottom: 10px; border-left: 4px solid #e94560; cursor: pointer; transition: background 0.2s, border-left-color 0.2s; user-select: none; }
.song-card.reviewed { background: #1a3a2a; border-left-color: #4caf50; }
.song-card.reviewed .song-name { color: #a0d8a0; }
.song-card.reviewed .meta { color: #7ab87a; }
.song-card.reviewed .shows { color: #6dbd8a; }
.song-card .song-name { font-size: 1.1em; font-weight: bold; color: #ffffff; }
.song-card .meta { color: #a0a0b0; font-size: 0.9em; margin-top: 4px; }
.song-card .shows { color: #53a8b6; margin-top: 4px; font-size: 0.9em; }
.song-card .media { margin-top: 6px; }
.song-card .media a { color: #e94560; text-decoration: none; margin-right: 10px; font-size: 0.85em; }
.song-card .media a:hover { text-decoration: underline; }
.no-media { color: #666; font-size: 0.85em; }
.ids-row { margin-top: 6px; font-size: 0.8em; color: #888; }
.ids-row .id-label { color: #a0a0b0; }
.copy-btn { background: #0f3460; color: #e0e0e0; border: none; padding: 1px 6px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-left: 4px; }
.copy-btn:hover { background: #e94560; }
.copy-btn.copied { background: #4caf50; }
.pagination { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 20px; flex-wrap: wrap; }
.pagination button { background: #0f3460; color: #e0e0e0; border: none; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.9em; }
.pagination button:hover { background: #e94560; }
.pagination button:disabled { opacity: 0.4; cursor: default; background: #0f3460; }
.pagination .page-info { color: #a0a0b0; font-size: 0.9em; }
.generated { text-align: center; color: #555; font-size: 0.8em; margin-top: 20px; }
</style>
</head>
<body>
<h1>ðŸŽµ Due Song Review</h1>
<div class="stats">
  <div class="total">Total due: {{TOTAL}} songs</div>
  <div class="level-dist" id="level-dist"></div>
</div>
<div class="pagination" id="pagination-top"></div>
<div id="song-list"></div>
<div class="pagination" id="pagination-bottom"></div>
<div class="generated">Generated by jankenoboe</div>
<script>
const SONGS = {{SONGS_JSON}};
const LEVEL_DIST = {{DIST_JSON}};
const PER_PAGE = 20;
var reviewedSet = {};
let currentPage = 1;
const totalPages = Math.max(1, Math.ceil(SONGS.length / PER_PAGE));

function renderLevelDist() {
  var html = '';
  for (var i = 0; i < LEVEL_DIST.length; i++) {
    var d = LEVEL_DIST[i];
    html += '<span class="level-badge">Lv.' + d.level + ' \u00d7 ' + d.count + '</span> ';
  }
  document.getElementById('level-dist').innerHTML = html;
}

function renderMediaHtml(mediaUrls) {
  if (!mediaUrls || mediaUrls.length === 0) {
    return '<span class="no-media">No media URLs</span>';
  }
  var parts = [];
  for (var j = 0; j < mediaUrls.length; j++) {
    var m = mediaUrls[j];
    var label = m.ext ? 'Media ' + (j + 1) + ' (' + m.ext + ')' : 'Media ' + (j + 1);
    parts.push('<a href="' + m.url + '" target="_blank" rel="noopener">' + label + '</a>');
  }
  return parts.join(' ');
}

function copyId(btn, text) {
  navigator.clipboard.writeText(text).then(function() {
    btn.classList.add('copied');
    btn.textContent = '\u2713';
    setTimeout(function() { btn.classList.remove('copied'); btn.textContent = '\u2398'; }, 1200);
  });
}

function renderIdsRow(s) {
  var parts = [];
  if (s.learningId) {
    parts.push('<span class="id-label">Learning:</span> ' + s.learningId +
      ' <button class="copy-btn" onclick="event.stopPropagation(); copyId(this, \'' + s.learningId + '\')" title="Copy learning ID">\u2398</button>');
  }
  if (s.songId) {
    parts.push('<span class="id-label">Song:</span> ' + s.songId +
      ' <button class="copy-btn" onclick="event.stopPropagation(); copyId(this, \'' + s.songId + '\')" title="Copy song ID">\u2398</button>');
  }
  if (s.showIds && s.showIds.length > 0) {
    for (var k = 0; k < s.showIds.length; k++) {
      parts.push('<span class="id-label">Show:</span> ' + s.showIds[k] +
        ' <button class="copy-btn" onclick="event.stopPropagation(); copyId(this, \'' + s.showIds[k] + '\')" title="Copy show ID">\u2398</button>');
    }
  }
  if (parts.length === 0) return '';
  return '<div class="ids-row">' + parts.join(' &nbsp;|&nbsp; ') + '</div>';
}

function render() {
  var start = (currentPage - 1) * PER_PAGE;
  var end = Math.min(start + PER_PAGE, SONGS.length);
  var list = document.getElementById('song-list');
  var html = '';
  for (var i = start; i < end; i++) {
    var s = SONGS[i];
    html += '<div class="song-card" data-idx="' + i + '">' +
      '<div class="song-name">' + (i+1) + '. ' + s.name + '</div>' +
      '<div class="meta">Artist: ' + s.artist + ' &nbsp;|&nbsp; Lv.' + s.level + ' &nbsp;|&nbsp; Wait: ' + s.waitDays + ' days</div>' +
      '<div class="shows">Shows: ' + (s.shows || 'N/A') + '</div>' +
      '<div class="media">' + renderMediaHtml(s.mediaUrls) + '</div>' +
      renderIdsRow(s) +
      '</div>';
  }
  list.innerHTML = html;
  list.querySelectorAll('.song-card').forEach(function(card) {
    var idx = card.getAttribute('data-idx');
    if (reviewedSet[idx]) card.classList.add('reviewed');
    card.addEventListener('click', function() {
      card.classList.toggle('reviewed');
      reviewedSet[idx] = card.classList.contains('reviewed');
    });
  });

  var pagHtml = '';
  if (totalPages > 1) {
    pagHtml =
      '<button onclick="go(1)" ' + (currentPage===1?'disabled':'') + '>&laquo;</button>' +
      '<button onclick="go(currentPage-1)" ' + (currentPage===1?'disabled':'') + '>&lsaquo;</button>' +
      '<span class="page-info">Page ' + currentPage + ' / ' + totalPages + '</span>' +
      '<button onclick="go(currentPage+1)" ' + (currentPage===totalPages?'disabled':'') + '>&rsaquo;</button>' +
      '<button onclick="go(totalPages)" ' + (currentPage===totalPages?'disabled':'') + '>&raquo;</button>';
  }
  document.getElementById('pagination-top').innerHTML = pagHtml;
  document.getElementById('pagination-bottom').innerHTML = pagHtml;
}

function go(p) { currentPage = Math.max(1, Math.min(p, totalPages)); render(); window.scrollTo(0,0); }
renderLevelDist();
render();
</script>
</body>
</html>