---
name: reviewing-due-songs
description: Display anime songs that are due for spaced repetition review as a formatted list or HTML report. Each entry shows the song name, artist, level, wait days, show names, and media URLs. Use when the user wants to see their due review list, practice queue, review songs with playback links, or mark all due songs as learned.
---

## Setup

The `jankenoboe` CLI must be installed. Set the `JANKENOBOE_DB` environment variable to the SQLite database path:
```bash
export JANKENOBOE_DB=~/db/datasource.db
```

**Always ask the user for the database path first** if `JANKENOBOE_DB` is not already set.

---

## Workflow

### Option A: Generate HTML Report (recommended)

Generate a self-contained HTML report with enriched data for all due songs:

```bash
jankenoboe learning-song-review
jankenoboe learning-song-review --output ~/reports/review.html
jankenoboe learning-song-review --limit 50
```

**Output (stdout):**
```json
{
  "file": "/path/to/learning-song-review.html",
  "count": 13
}
```

The HTML report includes:
- Summary statistics (total count, level distribution)
- Each song with: name, artist, level (display = stored + 1), wait days, show names, clickable media URLs
- Client-side pagination (20 songs per page)
- Sorted by level descending (highest level first)
- Self-contained — no external dependencies, works offline

Open the generated file in any browser to review.

### Option B: Get due songs as JSON

```bash
jankenoboe learning-due
jankenoboe learning-due --limit 20
```

**Output:**
```json
{
  "count": 13,
  "results": [
    {
      "id": "5a1af77e-...",
      "song_id": "3b105bd4-...",
      "song_name": "1-nichi wa 25-jikan.",
      "level": 16,
      "wait_days": 135
    }
  ]
}
```

#### Enrich with show names and media URLs (optional)

For each due song, look up its show associations and media URLs:

**Get show names:**
```bash
jankenoboe search rel_show_song --fields show_id,song_id,media_url --term '{"song_id": {"value": "<song_id>"}}'
```
Then for each `show_id`:
```bash
jankenoboe get show <show_id> --fields id,name
```

**Get artist name:**
```bash
jankenoboe get song <song_id> --fields id,name,artist_id
```
Then:
```bash
jankenoboe get artist <artist_id> --fields id,name
```

### Plain text format

Present each due song to the user in a readable format:

```
Due for Review: 13 songs

1. 1-nichi wa 25-jikan. (Lv.17, wait: 135 days)
   Artist: <artist_name>
   Shows: <show_name_1> | <show_name_2>

2. snowspring (Lv.9, wait: 5 days)
   Artist: ChoQMay
   Shows: A Sign of Affection
```

### Formatting rules

- Display level is stored level + 1 (levels are 0-indexed in the database, 1-indexed for display)
- If a song appears in multiple shows (via `rel_show_song`), join show names with ` | `
- Group or sort by level descending (highest level = longest-studied songs first)

---

## After Review

### Batch: Level up all due songs by 1

After reviewing the report, level up all due songs at once:

```bash
jankenoboe learning-song-levelup-due
jankenoboe learning-song-levelup-due --limit 20
```

**Output:**
```json
{
  "leveled_up_count": 11,
  "graduated_count": 2,
  "total_processed": 13
}
```

Songs at the maximum level (19, displayed as 20) are automatically graduated.

### Individual: Level up/down specific songs

For each song the user reviews individually:
- **Correct** → level up: `jankenoboe update learning <id> --data '{"level": <current+1>}'`
- **Forgotten** → level down: `jankenoboe update learning <id> --data '{"level": <lower_level>}'`
- **Level 19 + correct** → graduate: `jankenoboe update learning <id> --data '{"graduated": 1}'`

---

## Notes

- The due condition uses a 5-minute (300 second) warm-up for level 0 songs and day-based intervals for higher levels
- Levels are 0-indexed in the database but displayed as 1-indexed (level + 1)
- Media URLs come from both `rel_show_song` and `play_history`, deduplicated in the HTML report
- The HTML report is generated by the Rust binary and written to disk — no external tools needed